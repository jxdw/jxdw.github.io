<!DOCTYPE html>
<html lang=ZH>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>【nginx/haproxy技术知识体系】高可用软件之keepalived+Haproxy | 渐学顿悟</title>
  <meta name="description" content="资料https:&#x2F;&#x2F;blog.51cto.com&#x2F;kernal&#x2F;1433907  背景交代本文使用软件版本keepalived: v1.2.13haproxy: v1.5.18centos: centos6.3、centos7.3lightttpd: 1.4.52  ip和部署规划192.168.128.50(主K)：centos6、keepalived、h">
<meta property="og:type" content="article">
<meta property="og:title" content="【nginx&#x2F;haproxy技术知识体系】高可用软件之keepalived+Haproxy">
<meta property="og:url" content="https://jxdw.github.io/2017/03/10/common-ha-software-haproxy/index.html">
<meta property="og:site_name" content="渐学顿悟">
<meta property="og:description" content="资料https:&#x2F;&#x2F;blog.51cto.com&#x2F;kernal&#x2F;1433907  背景交代本文使用软件版本keepalived: v1.2.13haproxy: v1.5.18centos: centos6.3、centos7.3lightttpd: 1.4.52  ip和部署规划192.168.128.50(主K)：centos6、keepalived、h">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2017-03-10T03:27:58.000Z">
<meta property="article:modified_time" content="2020-10-10T15:08:23.394Z">
<meta property="article:author" content="渐学顿悟">
<meta property="article:tag" content="nginx&#x2F;haproxy技术">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="https://jxdw.github.io/2017/03/10/common-ha-software-haproxy/index.html">
  
    <link rel="alternate" href="/atom.xml" title="渐学顿悟" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.2.0"></head>


<body class="main-center theme-purple" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/jxdw" target="_blank">
          <img class="img-circle img-rotate" src="https://www.gravatar.com/avatar/80df4bfee856f0107ea8d54da41c3f31?s=128" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">渐学顿悟</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">程序员(后端)</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/2020/">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/jxdw" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">博客公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>2020年，重新开始。欢迎交流与分享!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文章标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos-docker-k8s%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/" rel="tag">centos/docker/k8s知识体系</a><span class="tag-list-count">34</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elastic-job%E6%8A%80%E6%9C%AF/" rel="tag">elastic-job技术</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6%E8%AF%AD%E8%A8%80/" rel="tag">es6语言</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/" rel="tag">golang知识体系</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/" rel="tag">java知识体系</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql%E6%8A%80%E6%9C%AF/" rel="tag">mysql技术</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx-haproxy%E6%8A%80%E6%9C%AF/" rel="tag">nginx/haproxy技术</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prometheus%E6%8A%80%E6%9C%AF/" rel="tag">prometheus技术</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rabbitmq%E6%8A%80%E6%9C%AF/" rel="tag">rabbitmq技术</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis%E6%8A%80%E6%9C%AF/" rel="tag">redis技术</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zipkin-jaeger%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/" rel="tag">zipkin/jaeger知识体系</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%84%9F%E6%82%9F/" rel="tag">感悟</a><span class="tag-list-count">6</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">文章归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">22</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">40</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">33</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">13</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最近文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2020/09/25/nacos-go-client-config-example/" class="title">【中间件go client系列】go语言服务使用nacos server作为配置中心</a>
              </p>
              <p class="item-date">
                <time datetime="2020-09-25T11:17:59.000Z" itemprop="datePublished">2020-09-25 19:17:59</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2020/07/20/golang-upload-file-to-alicloud/" class="title">【中间件go client系列】阿里云oss的go client使用</a>
              </p>
              <p class="item-date">
                <time datetime="2020-07-20T12:17:59.000Z" itemprop="datePublished">2020-07-20 20:17:59</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2020/07/14/es6_vue_study_day8/" class="title">【转载】vue学习之day8</a>
              </p>
              <p class="item-date">
                <time datetime="2020-07-14T13:41:16.000Z" itemprop="datePublished">2020-07-14 21:41:16</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2020/07/13/es6_vue_study_day7/" class="title">【转载】vue学习之day7</a>
              </p>
              <p class="item-date">
                <time datetime="2020-07-13T13:25:16.000Z" itemprop="datePublished">2020-07-13 21:25:16</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2020/07/12/es6_vue_study_day6/" class="title">【转载】vue学习之day6</a>
              </p>
              <p class="item-date">
                <time datetime="2020-07-12T13:21:16.000Z" itemprop="datePublished">2020-07-12 21:21:16</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-common-ha-software-haproxy" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      【nginx/haproxy技术知识体系】高可用软件之keepalived+Haproxy
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2017/03/10/common-ha-software-haproxy/" class="article-date">
	  <time datetime="2017-03-10T03:27:58.000Z" itemprop="datePublished">2017-03-10 11:27:58</time>
	</a>
</span>
        
        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/nginx-haproxy%E6%8A%80%E6%9C%AF/" rel="tag">nginx/haproxy技术</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2017/03/10/common-ha-software-haproxy/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.51cto.com&#x2F;kernal&#x2F;1433907</span><br></pre></td></tr></table></figure>

<h1 id="背景交代"><a href="#背景交代" class="headerlink" title="背景交代"></a>背景交代</h1><h2 id="本文使用软件版本"><a href="#本文使用软件版本" class="headerlink" title="本文使用软件版本"></a>本文使用软件版本</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">keepalived: v1.2.13</span><br><span class="line">haproxy: v1.5.18</span><br><span class="line">centos: centos6.3、centos7.3</span><br><span class="line">lightttpd: 1.4.52</span><br></pre></td></tr></table></figure>

<h2 id="ip和部署规划"><a href="#ip和部署规划" class="headerlink" title="ip和部署规划"></a>ip和部署规划</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">192.168.128.50(主K)：centos6、keepalived、haproxy</span><br><span class="line">192.168.128.51(次K)：centos6、keepalived、haproxy</span><br><span class="line">192.168.128.85(real server1)：centos7、lighttpd</span><br><span class="line">192.168.128.97(real server2)：centos7、lighttpd</span><br></pre></td></tr></table></figure>
<h2 id="需要确保的事情"><a href="#需要确保的事情" class="headerlink" title="需要确保的事情"></a>需要确保的事情</h2><h1 id="安装软件并配置"><a href="#安装软件并配置" class="headerlink" title="安装软件并配置"></a>安装软件并配置</h1><h2 id="安装lighttpd"><a href="#安装lighttpd" class="headerlink" title="安装lighttpd"></a>安装lighttpd</h2><p>yum install -y epel-release gcc gcc-c++ autoconf automake   pcre-devel zip unzip libtool  &amp;&amp; yum install -y lighttpd</p>
<h2 id="配置lighttpd"><a href="#配置lighttpd" class="headerlink" title="配置lighttpd"></a>配置lighttpd</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#######################################################################</span><br><span class="line">##</span><br><span class="line">## &#x2F;etc&#x2F;lighttpd&#x2F;lighttpd.conf</span><br><span class="line">##</span><br><span class="line">## check &#x2F;etc&#x2F;lighttpd&#x2F;conf.d&#x2F;*.conf for the configuration of modules.</span><br><span class="line">##</span><br><span class="line">#######################################################################</span><br><span class="line"></span><br><span class="line">#######################################################################</span><br><span class="line">##</span><br><span class="line">## Some Variable definition which will make chrooting easier.</span><br><span class="line">##</span><br><span class="line">## if you add a variable here. Add the corresponding variable in the</span><br><span class="line">## chroot example aswell.</span><br><span class="line">##</span><br><span class="line">var.log_root    &#x3D; &quot;&#x2F;data&#x2F;lighttpd&#x2F;log&quot;</span><br><span class="line">var.server_root &#x3D; &quot;&#x2F;data&#x2F;lighttpd&#x2F;www&quot;</span><br><span class="line">var.state_dir   &#x3D; &quot;&#x2F;var&#x2F;run&quot;</span><br><span class="line">var.home_dir    &#x3D; &quot;&#x2F;data&#x2F;lighttpd&quot;</span><br><span class="line">var.conf_dir    &#x3D; &quot;&#x2F;etc&#x2F;lighttpd&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## run the server chrooted.</span><br><span class="line">##</span><br><span class="line">## This requires root permissions during startup.</span><br><span class="line">##</span><br><span class="line">## If you run Chrooted set the the variables to directories relative to</span><br><span class="line">## the chroot dir.</span><br><span class="line">##</span><br><span class="line">## example chroot configuration:</span><br><span class="line">##</span><br><span class="line">#var.log_root    &#x3D; &quot;&#x2F;logs&quot;</span><br><span class="line">#var.server_root &#x3D; &quot;&#x2F;&quot;</span><br><span class="line">#var.state_dir   &#x3D; &quot;&#x2F;run&quot;</span><br><span class="line">#var.home_dir    &#x3D; &quot;&#x2F;lib&#x2F;lighttpd&quot;</span><br><span class="line">#var.vhosts_dir  &#x3D; &quot;&#x2F;vhosts&quot;</span><br><span class="line">#var.conf_dir    &#x3D; &quot;&#x2F;etc&quot;</span><br><span class="line">#</span><br><span class="line">#server.chroot   &#x3D; &quot;&#x2F;srv&#x2F;www&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Some additional variables to make the configuration easier</span><br><span class="line">##</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Base directory for all virtual hosts</span><br><span class="line">##</span><br><span class="line">## used in:</span><br><span class="line">## conf.d&#x2F;evhost.conf</span><br><span class="line">## conf.d&#x2F;simple_vhost.conf</span><br><span class="line">## vhosts.d&#x2F;vhosts.template</span><br><span class="line">##</span><br><span class="line">var.vhosts_dir  &#x3D; server_root + &quot;&#x2F;vhosts&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Cache for mod_compress</span><br><span class="line">##</span><br><span class="line">## used in:</span><br><span class="line">## conf.d&#x2F;compress.conf</span><br><span class="line">##</span><br><span class="line">var.cache_dir   &#x3D; &quot;&#x2F;data&#x2F;lighttpd&#x2F;cache&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Base directory for sockets.</span><br><span class="line">##</span><br><span class="line">## used in:</span><br><span class="line">## conf.d&#x2F;fastcgi.conf</span><br><span class="line">## conf.d&#x2F;scgi.conf</span><br><span class="line">##</span><br><span class="line">var.socket_dir  &#x3D; state_dir + &quot;&#x2F;sockets&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">#######################################################################</span><br><span class="line"></span><br><span class="line">#######################################################################</span><br><span class="line">##</span><br><span class="line">## Load the modules.</span><br><span class="line">include &quot;modules.conf&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">#######################################################################</span><br><span class="line"></span><br><span class="line">#######################################################################</span><br><span class="line">##</span><br><span class="line">##  Basic Configuration</span><br><span class="line">## ---------------------</span><br><span class="line">##</span><br><span class="line">server.port &#x3D; 28080</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Use IPv6?</span><br><span class="line">##</span><br><span class="line">#server.use-ipv6 &#x3D; &quot;enable&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## bind to a specific IP</span><br><span class="line">##</span><br><span class="line">server.bind &#x3D; &quot;192.168.128.97&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Run as a different username&#x2F;groupname.</span><br><span class="line">## This requires root permissions during startup.</span><br><span class="line">##</span><br><span class="line">server.username  &#x3D; &quot;lighttpd&quot;</span><br><span class="line">server.groupname &#x3D; &quot;lighttpd&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## enable core files.</span><br><span class="line">##</span><br><span class="line">#server.core-files &#x3D; &quot;disable&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Document root</span><br><span class="line">##</span><br><span class="line">server.document-root &#x3D; server_root + &quot;&#x2F;lighttpd&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## The value for the &quot;Server:&quot; response field.</span><br><span class="line">##</span><br><span class="line">## It would be nice to keep it at &quot;lighttpd&quot;.</span><br><span class="line">##</span><br><span class="line">#server.tag &#x3D; &quot;lighttpd&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## store a pid file</span><br><span class="line">##</span><br><span class="line">server.pid-file &#x3D; state_dir + &quot;&#x2F;lighttpd.pid&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">#######################################################################</span><br><span class="line"></span><br><span class="line">#######################################################################</span><br><span class="line">##</span><br><span class="line">##  Logging Options</span><br><span class="line">## ------------------</span><br><span class="line">##</span><br><span class="line">## all logging options can be overwritten per vhost.</span><br><span class="line">##</span><br><span class="line">## Path to the error log file</span><br><span class="line">##</span><br><span class="line">server.errorlog             &#x3D; log_root + &quot;&#x2F;error.log&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## If you want to log to syslog you have to unset the</span><br><span class="line">## server.errorlog setting and uncomment the next line.</span><br><span class="line">##</span><br><span class="line">#server.errorlog-use-syslog &#x3D; &quot;enable&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Access log config</span><br><span class="line">##</span><br><span class="line">include &quot;conf.d&#x2F;access_log.conf&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## The debug options are moved into their own file.</span><br><span class="line">## see conf.d&#x2F;debug.conf for various options for request debugging.</span><br><span class="line">##</span><br><span class="line">include &quot;conf.d&#x2F;debug.conf&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">#######################################################################</span><br><span class="line"></span><br><span class="line">#######################################################################</span><br><span class="line">##</span><br><span class="line">##  Tuning&#x2F;Performance</span><br><span class="line">## --------------------</span><br><span class="line">##</span><br><span class="line">## corresponding documentation:</span><br><span class="line">## https:&#x2F;&#x2F;redmine.lighttpd.net&#x2F;projects&#x2F;lighttpd&#x2F;wiki&#x2F;Docs_Performance</span><br><span class="line">##</span><br><span class="line">## set the event-handler (read the performance section in the manual)</span><br><span class="line">##</span><br><span class="line">## possible options on linux are:</span><br><span class="line">##</span><br><span class="line">## select</span><br><span class="line">## poll</span><br><span class="line">## linux-sysepoll</span><br><span class="line">##</span><br><span class="line">## linux-sysepoll is recommended on kernel 2.6.</span><br><span class="line">##</span><br><span class="line">server.event-handler &#x3D; &quot;linux-sysepoll&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## The basic network interface for all platforms at the syscalls read()</span><br><span class="line">## and write(). Every modern OS provides its own syscall to help network</span><br><span class="line">## servers transfer files as fast as possible</span><br><span class="line">##</span><br><span class="line">## sendfile       - is recommended for small files.</span><br><span class="line">## writev         - is recommended for sending many large files</span><br><span class="line">##</span><br><span class="line">server.network-backend &#x3D; &quot;sendfile&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## As lighttpd is a single-threaded server, its main resource limit is</span><br><span class="line">## the number of file descriptors, which is set to 1024 by default (on</span><br><span class="line">## most systems).</span><br><span class="line">##</span><br><span class="line">## If you are running a high-traffic site you might want to increase this</span><br><span class="line">## limit by setting server.max-fds.</span><br><span class="line">##</span><br><span class="line">## Changing this setting requires root permissions on startup. see</span><br><span class="line">## server.username&#x2F;server.groupname.</span><br><span class="line">##</span><br><span class="line">## By default lighttpd would not change the operation system default.</span><br><span class="line">## But setting it to 2048 is a better default for busy servers.</span><br><span class="line">##</span><br><span class="line">## With SELinux enabled, this is denied by default and needs to be allowed</span><br><span class="line">## by running the following once : setsebool -P httpd_setrlimit on</span><br><span class="line">#server.max-fds &#x3D; 2048</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## listen-backlog is the size of the listen() backlog queue requested when</span><br><span class="line">## the lighttpd server ask the kernel to listen() on the provided network</span><br><span class="line">## address.  Clients attempting to connect() to the server enter the listen()</span><br><span class="line">## backlog queue and wait for the lighttpd server to accept() the connection.</span><br><span class="line">##</span><br><span class="line">## The out-of-box default on many operating systems is 128 and is identified</span><br><span class="line">## as SOMAXCONN.  This can be tuned on many operating systems.  (On Linux,</span><br><span class="line">## cat &#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;somaxconn)  Requesting a size larger than operating</span><br><span class="line">## system limit will be silently reduced to the limit by the operating system.</span><br><span class="line">##</span><br><span class="line">## When there are too many connection attempts waiting for the server to</span><br><span class="line">## accept() new connections, the listen backlog queue fills and the kernel</span><br><span class="line">## rejects additional connection attempts.  This can be useful as an</span><br><span class="line">## indication to an upstream load balancer that the server is busy, and</span><br><span class="line">## possibly overloaded.  In that case, configure a smaller limit for</span><br><span class="line">## server.listen-backlog.  On the other hand, configure a larger limit to be</span><br><span class="line">## able to handle bursts of new connections, but only do so up to an amount</span><br><span class="line">## that the server can keep up with responding in a reasonable amount of</span><br><span class="line">## time.  Otherwise, clients may abandon the connection attempts and the</span><br><span class="line">## server will waste resources servicing abandoned connections.</span><br><span class="line">##</span><br><span class="line">## It is best to leave this setting at its default unless you have modelled</span><br><span class="line">## your traffic and tested that changing this benefits your traffic patterns.</span><br><span class="line">##</span><br><span class="line">## Default: 1024</span><br><span class="line">##</span><br><span class="line">#server.listen-backlog &#x3D; 128</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Stat() call caching.</span><br><span class="line">##</span><br><span class="line">## lighttpd can utilize FAM&#x2F;Gamin to cache stat call.</span><br><span class="line">##</span><br><span class="line">## possible values are:</span><br><span class="line">## disable, simple or fam.</span><br><span class="line">##</span><br><span class="line">server.stat-cache-engine &#x3D; &quot;simple&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Fine tuning for the request handling</span><br><span class="line">##</span><br><span class="line">## max-connections &#x3D;&#x3D; max-fds&#x2F;2 (maybe &#x2F;3)</span><br><span class="line">## means the other file handles are used for fastcgi&#x2F;files</span><br><span class="line">##</span><br><span class="line">server.max-connections &#x3D; 1024</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## How many seconds to keep a keep-alive connection open,</span><br><span class="line">## until we consider it idle.</span><br><span class="line">##</span><br><span class="line">## Default: 5</span><br><span class="line">##</span><br><span class="line">#server.max-keep-alive-idle &#x3D; 5</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## How many keep-alive requests until closing the connection.</span><br><span class="line">##</span><br><span class="line">## Default: 16</span><br><span class="line">##</span><br><span class="line">#server.max-keep-alive-requests &#x3D; 16</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Maximum size of a request in kilobytes.</span><br><span class="line">## By default it is unlimited (0).</span><br><span class="line">##</span><br><span class="line">## Uploads to your server cant be larger than this value.</span><br><span class="line">##</span><br><span class="line">#server.max-request-size &#x3D; 0</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Time to read from a socket before we consider it idle.</span><br><span class="line">##</span><br><span class="line">## Default: 60</span><br><span class="line">##</span><br><span class="line">#server.max-read-idle &#x3D; 60</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Time to write to a socket before we consider it idle.</span><br><span class="line">##</span><br><span class="line">## Default: 360</span><br><span class="line">##</span><br><span class="line">#server.max-write-idle &#x3D; 360</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">##  Traffic Shaping</span><br><span class="line">## -----------------</span><br><span class="line">##</span><br><span class="line">## see &#x2F;usr&#x2F;share&#x2F;doc&#x2F;lighttpd&#x2F;traffic-shaping.txt</span><br><span class="line">##</span><br><span class="line">## Values are in kilobyte per second.</span><br><span class="line">##</span><br><span class="line">## Keep in mind that a limit below 32kB&#x2F;s might actually limit the</span><br><span class="line">## traffic to 32kB&#x2F;s. This is caused by the size of the TCP send</span><br><span class="line">## buffer.</span><br><span class="line">##</span><br><span class="line">## per server:</span><br><span class="line">##</span><br><span class="line">#server.kbytes-per-second &#x3D; 128</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## per connection:</span><br><span class="line">##</span><br><span class="line">#connection.kbytes-per-second &#x3D; 32</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">#######################################################################</span><br><span class="line"></span><br><span class="line">#######################################################################</span><br><span class="line">##</span><br><span class="line">##  Filename&#x2F;File handling</span><br><span class="line">## ------------------------</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## files to check for if ...&#x2F; is requested</span><br><span class="line">## index-file.names            &#x3D; ( &quot;index.php&quot;, &quot;index.rb&quot;, &quot;index.html&quot;,</span><br><span class="line">##                                 &quot;index.htm&quot;, &quot;default.htm&quot; )</span><br><span class="line">##</span><br><span class="line">index-file.names +&#x3D; (</span><br><span class="line">  &quot;index.xhtml&quot;, &quot;index.html&quot;, &quot;index.htm&quot;, &quot;default.htm&quot;, &quot;index.php&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## deny access the file-extensions</span><br><span class="line">##</span><br><span class="line">## ~    is for backupfiles from vi, emacs, joe, ...</span><br><span class="line">## .inc is often used for code includes which should in general not be part</span><br><span class="line">##      of the document-root</span><br><span class="line">url.access-deny             &#x3D; ( &quot;~&quot;, &quot;.inc&quot; )</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## disable range requests for pdf files</span><br><span class="line">## workaround for a bug in the Acrobat Reader plugin.</span><br><span class="line">##</span><br><span class="line">$HTTP[&quot;url&quot;] &#x3D;~ &quot;\.pdf$&quot; &#123;</span><br><span class="line">  server.range-requests &#x3D; &quot;disable&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## url handling modules (rewrite, redirect)</span><br><span class="line">##</span><br><span class="line">#url.rewrite                &#x3D; ( &quot;^&#x2F;$&quot;             &#x3D;&gt; &quot;&#x2F;server-status&quot; )</span><br><span class="line">#url.redirect               &#x3D; ( &quot;^&#x2F;wishlist&#x2F;(.+)&quot; &#x3D;&gt; &quot;http:&#x2F;&#x2F;www.example.com&#x2F;$1&quot; )</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## both rewrite&#x2F;redirect support back reference to regex conditional using %n</span><br><span class="line">##</span><br><span class="line">#$HTTP[&quot;host&quot;] &#x3D;~ &quot;^www\.(.*)&quot; &#123;</span><br><span class="line">#  url.redirect            &#x3D; ( &quot;^&#x2F;(.*)&quot; &#x3D;&gt; &quot;http:&#x2F;&#x2F;%1&#x2F;$1&quot; )</span><br><span class="line">#&#125;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## which extensions should not be handle via static-file transfer</span><br><span class="line">##</span><br><span class="line">## .php, .pl, .fcgi are most often handled by mod_fastcgi or mod_cgi</span><br><span class="line">##</span><br><span class="line">static-file.exclude-extensions &#x3D; ( &quot;.php&quot;, &quot;.pl&quot;, &quot;.fcgi&quot;, &quot;.scgi&quot; )</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## error-handler for all status 400-599</span><br><span class="line">##</span><br><span class="line">#server.error-handler       &#x3D; &quot;&#x2F;error-handler.html&quot;</span><br><span class="line">#server.error-handler       &#x3D; &quot;&#x2F;error-handler.php&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## error-handler for status 404</span><br><span class="line">##</span><br><span class="line">#server.error-handler-404   &#x3D; &quot;&#x2F;error-handler.html&quot;</span><br><span class="line">#server.error-handler-404   &#x3D; &quot;&#x2F;error-handler.php&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Format: &lt;errorfile-prefix&gt;&lt;status-code&gt;.html</span><br><span class="line">## -&gt; ....&#x2F;status-404.html for &#39;File not found&#39;</span><br><span class="line">##</span><br><span class="line">#server.errorfile-prefix    &#x3D; &quot;&#x2F;srv&#x2F;www&#x2F;htdocs&#x2F;errors&#x2F;status-&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## mimetype mapping</span><br><span class="line">##</span><br><span class="line">include &quot;conf.d&#x2F;mime.conf&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## directory listing configuration</span><br><span class="line">##</span><br><span class="line">include &quot;conf.d&#x2F;dirlisting.conf&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## Should lighttpd follow symlinks?</span><br><span class="line">##</span><br><span class="line">server.follow-symlink &#x3D; &quot;enable&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## force all filenames to be lowercase?</span><br><span class="line">##</span><br><span class="line">#server.force-lowercase-filenames &#x3D; &quot;disable&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## defaults to &#x2F;var&#x2F;tmp as we assume it is a local harddisk</span><br><span class="line">##</span><br><span class="line">server.upload-dirs &#x3D; ( &quot;&#x2F;var&#x2F;tmp&quot; )</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">#######################################################################</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#######################################################################</span><br><span class="line">##</span><br><span class="line">##  SSL Support</span><br><span class="line">## -------------</span><br><span class="line">##</span><br><span class="line">## To enable SSL for the whole server you have to provide a valid</span><br><span class="line">## certificate and have to enable the SSL engine.::</span><br><span class="line">##</span><br><span class="line">##   ssl.engine &#x3D; &quot;enable&quot;</span><br><span class="line">##   ssl.pemfile &#x3D; &quot;&#x2F;path&#x2F;to&#x2F;server.pem&quot;</span><br><span class="line">##</span><br><span class="line">## The HTTPS protocol does not allow you to use name-based virtual</span><br><span class="line">## hosting with SSL. If you want to run multiple SSL servers with</span><br><span class="line">## one lighttpd instance you must use IP-based virtual hosting: ::</span><br><span class="line">##</span><br><span class="line">## Mitigate CVE-2009-3555 by disabling client triggered renegotation</span><br><span class="line">## This is enabled by default.</span><br><span class="line">##</span><br><span class="line">## IMPORTANT: this setting can only be used in the global scope.</span><br><span class="line">## It does *not* work inside conditionals</span><br><span class="line">##</span><br><span class="line">#   ssl.disable-client-renegotiation &#x3D; &quot;enable&quot;</span><br><span class="line">##</span><br><span class="line">##   $SERVER[&quot;socket&quot;] &#x3D;&#x3D; &quot;10.0.0.1:443&quot; &#123;</span><br><span class="line">##     ssl.engine                  &#x3D; &quot;enable&quot;</span><br><span class="line">##     ssl.pemfile                 &#x3D; &quot;&#x2F;etc&#x2F;ssl&#x2F;private&#x2F;www.example.com.pem&quot;</span><br><span class="line">##     #</span><br><span class="line">##     # (Following SSL&#x2F;TLS Deployment Best Practices 1.3 &#x2F; 17 September 2013 from:</span><br><span class="line">##     # https:&#x2F;&#x2F;www.ssllabs.com&#x2F;projects&#x2F;best-practices&#x2F;index.html)</span><br><span class="line">##     # - BEAST is considered mitigaed on client side now, and new weaknesses have been found in RC4,</span><br><span class="line">##     #   so it is strongly advised to disable RC4 ciphers (HIGH doesn&#39;t include RC4)</span><br><span class="line">##     # - It is recommended to disable 3DES too (although disabling RC4 and 3DES breaks IE6+8 on Windows XP,</span><br><span class="line">##     #   so you might want to support 3DES for now - just remove the &#39;!3DES&#39; parts below).</span><br><span class="line">##     # - The examples below prefer ciphersuites with &quot;Forward Secrecy&quot; (and ECDHE over DHE (alias EDH)), remove &#39;+kEDH +kRSA&#39;</span><br><span class="line">##     #   if you don&#39;t want that.</span><br><span class="line">##     # - SRP and PSK are not supported anyway, excluding those (&#39;!kSRP !kPSK&#39;) just keeps the list smaller (easier to review)</span><br><span class="line">##     # Check your cipher list with: openssl ciphers -v &#39;...&#39; (use single quotes as your shell won&#39;t like ! in double quotes)</span><br><span class="line">##     #</span><br><span class="line">##     # If you know you have RSA keys (standard), you can use:</span><br><span class="line">##     ssl.cipher-list             &#x3D; &quot;PROFILE&#x3D;SYSTEM&quot;</span><br><span class="line">##     # The more generic version (without the restriction to RSA keys) is</span><br><span class="line">##     # ssl.cipher-list           &#x3D; &quot;HIGH !aNULL !3DES +kEDH +kRSA !kSRP !kPSK&quot;</span><br><span class="line">##     #</span><br><span class="line">##     # Make the server prefer the order of the server side cipher suite instead of the client suite.</span><br><span class="line">##     # This option is enabled by default, but only used if ssl.cipher-list is set.</span><br><span class="line">##     #</span><br><span class="line">##     # ssl.honor-cipher-order &#x3D; &quot;enable&quot;</span><br><span class="line">##     #</span><br><span class="line">##     server.name                 &#x3D; &quot;www.example.com&quot;</span><br><span class="line">##</span><br><span class="line">##     server.document-root        &#x3D; &quot;&#x2F;srv&#x2F;www&#x2F;vhosts&#x2F;example.com&#x2F;www&#x2F;&quot;</span><br><span class="line">##   &#125;</span><br><span class="line">##</span><br><span class="line"></span><br><span class="line">## If you have a .crt and a .key file, cat them together into a</span><br><span class="line">## single PEM file:</span><br><span class="line">## $ cat &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;lighttpd.key &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;lighttpd.crt \</span><br><span class="line">##   &gt; &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;lighttpd.pem</span><br><span class="line">##</span><br><span class="line">#ssl.pemfile &#x3D; &quot;&#x2F;etc&#x2F;ssl&#x2F;private&#x2F;lighttpd.pem&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## optionally pass the CA certificate here.</span><br><span class="line">##</span><br><span class="line">##</span><br><span class="line">#ssl.ca-file &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">## and the CRL revocation list here.</span><br><span class="line">##</span><br><span class="line">##</span><br><span class="line">#ssl.ca-crl-file &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">#######################################################################</span><br><span class="line"></span><br><span class="line">#######################################################################</span><br><span class="line">##</span><br><span class="line">## custom includes like vhosts.</span><br><span class="line">##</span><br><span class="line">#include &quot;conf.d&#x2F;config.conf&quot;</span><br><span class="line">#include &quot;&#x2F;etc&#x2F;lighttpd&#x2F;vhosts.d&#x2F;*.conf&quot;</span><br><span class="line">##</span><br><span class="line">#######################################################################</span><br></pre></td></tr></table></figure>
      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://jxdw.github.io/2017/03/10/common-ha-software-haproxy/" title="【nginx/haproxy技术知识体系】高可用软件之keepalived+Haproxy" target="_blank" rel="external">https://jxdw.github.io/2017/03/10/common-ha-software-haproxy/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/jxdw" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://www.gravatar.com/avatar/80df4bfee856f0107ea8d54da41c3f31?s=128" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/jxdw" target="_blank"><span class="text-dark">渐学顿悟</span><small class="ml-1x">程序员(后端)</small></a></h3>
        <div>一个没有技术慧根/悟性的人，只有需要渐学/刻意练习，方能顿悟，自勉。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2017/03/13/docker-redis-master-slave/" title="【redis知识体系】docker1.10安装redis主从"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2017/02/14/docker-network-introduce/" title="【网络系列】【转载】docker容器的网络模式"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/jxdw" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2020 渐学顿悟
        
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: true,
    notify: false,
    appId: 'wrre3Nrx21CqKiChLnKn034M-gzGzoHsz',
    appKey: 'rkWWNONo7LAJhlS936vnywQ9',
    placeholder: '请输入您的评论',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>