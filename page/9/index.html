<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jxdw.github.io","root":"/","scheme":"Pisces","version":"8.0.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"width":240},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="渐学顿悟">
<meta property="og:url" content="https://jxdw.github.io/page/9/index.html">
<meta property="og:site_name" content="渐学顿悟">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="渐学顿悟">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://jxdw.github.io/page/9/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>渐学顿悟</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="渐学顿悟" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">渐学顿悟</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录技术的学习和实践过程</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">12</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">122</span></a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="渐学顿悟"
      src="/favicon.png">
  <p class="site-author-name" itemprop="name">渐学顿悟</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">122</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/12/03/spring-cloud-1x-cloud-netfix-ribbon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/12/03/spring-cloud-1x-cloud-netfix-ribbon/" class="post-title-link" itemprop="url">【java框架系列】spring-cloud之netfix-ribbon</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-03 17:14:29 17:14:29" itemprop="dateCreated datePublished" datetime="2017-12-03T17:14:29+08:00">2017-12-03 17:14:29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-13 22:09:22 22:09:22" itemprop="dateModified" datetime="2020-10-13T22:09:22+08:00">2020-10-13 22:09:22</time>
      </span>

  
    <span id="/2017/12/03/spring-cloud-1x-cloud-netfix-ribbon/" class="post-meta-item leancloud_visitors" data-flag-title="【java框架系列】spring-cloud之netfix-ribbon" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/12/03/spring-cloud-1x-cloud-netfix-ribbon/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/12/03/spring-cloud-1x-cloud-netfix-ribbon/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="关于spring-boot-cloud-1-X系列"><a href="#关于spring-boot-cloud-1-X系列" class="headerlink" title="关于spring boot/cloud 1.X系列"></a>关于spring boot/cloud 1.X系列</h1><h2 id="关于spring-boot-1-X系列"><a href="#关于spring-boot-1-X系列" class="headerlink" title="关于spring boot 1.X系列"></a>关于spring boot 1.X系列</h2><p>spring.io在spring boot和springcloud推出之前，开源了很多的框架（见下文附录），但是除了spring framework自身，影响力都不够。直到spring boot、spring cloud系列框架推出，才成了spring框架的扩展中最有影响力的两个(或者说集大成者)。<br>Spring Boot的设计目的是用来简化新Spring应用的初始搭建以及开发过程。该框架使用了特定的方式来进行配置，从而使开发人员不再需要定义样板化的配置。<br>通俗点理解，就是spring boot其实不是什么新的框架，它默认配置了很多框架的使用方式，就像maven整合了很多的jar包，比如散落在各处的spring框架：spring amqp、spring data redis client、spring web service，进而集大成。</p>
<h2 id="关于spring-cloud-1-X系列"><a href="#关于spring-cloud-1-X系列" class="headerlink" title="关于spring cloud 1.X系列"></a>关于spring cloud 1.X系列</h2><p>Spring Cloud为开发人员提供了快速构建分布式系统中一些常见模式的工具，例如配置管理，服务发现，断路器，智能路由，微代理，控制总线，一次性令牌，全局锁定，领导选举，分布式会话，集群状态。<br>从技术实现上来说，也是集成开源届的各种方案比如 client、rabbitmq client、eureka client。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/11/30/spring-cloud-1x-talka-bout-cloud-14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/11/30/spring-cloud-1x-talka-bout-cloud-14/" class="post-title-link" itemprop="url">【java实现微服务架构系列】spring-cloud edgware版本解读</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-30 10:45:49 10:45:49" itemprop="dateCreated datePublished" datetime="2017-11-30T10:45:49+08:00">2017-11-30 10:45:49</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-13 22:02:40 22:02:40" itemprop="dateModified" datetime="2020-10-13T22:02:40+08:00">2020-10-13 22:02:40</time>
      </span>

  
    <span id="/2017/11/30/spring-cloud-1x-talka-bout-cloud-14/" class="post-meta-item leancloud_visitors" data-flag-title="【java实现微服务架构系列】spring-cloud edgware版本解读" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/11/30/spring-cloud-1x-talka-bout-cloud-14/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/11/30/spring-cloud-1x-talka-bout-cloud-14/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://spring.io/blog/2017/11/27/spring-cloud-edgware-release-available">https://spring.io/blog/2017/11/27/spring-cloud-edgware-release-available</a></p>
<h2 id="关于spring-boot-cloud-1-X系列"><a href="#关于spring-boot-cloud-1-X系列" class="headerlink" title="关于spring boot/cloud 1.X系列"></a>关于spring boot/cloud 1.X系列</h2><p>spring.io在spring boot和springcloud推出之前，开源了很多的框架（见下文附录），但是除了spring framework自身，影响力都不够。直到spring boot、spring cloud系列框架推出，才成了spring框架的扩展中最有影响力的两个(或者说集大成者)。<br>Spring Boot的设计目的是用来简化新Spring应用的初始搭建以及开发过程。该框架使用了特定的方式来进行配置，从而使开发人员不再需要定义样板化的配置。<br>通俗点理解，就是spring boot其实不是什么新的框架，它默认配置了很多框架的使用方式，就像maven整合了很多的jar包，比如散落在各处的spring框架：spring amqp、spring data redis client、spring web service，进而集大成。</p>
<h2 id="关于spring-cloud"><a href="#关于spring-cloud" class="headerlink" title="关于spring cloud"></a>关于spring cloud</h2><p>Spring Cloud为开发人员提供了快速构建分布式系统中一些常见模式的工具，例如配置管理，服务发现，断路器，智能路由，微代理，控制总线，一次性令牌，全局锁定，领导选举，分布式会话，集群状态。<br>从技术实现上来说，也是集成开源届的各种方案比如 client、rabbitmq client、eureka client。<br><img src="https://jxdw.github.io/img/program/java/spring_cloud_edgware_release.png"></p>
<h1 id="springcloud非商业公司部分"><a href="#springcloud非商业公司部分" class="headerlink" title="springcloud非商业公司部分"></a>springcloud非商业公司部分</h1><h2 id="spring-cloud-common"><a href="#spring-cloud-common" class="headerlink" title="spring-cloud-common"></a>spring-cloud-common</h2><p>Spring Cloud Commons是一组在不同Spring Cloud实现中使用的抽象和公共类（例如，Spring Cloud Netflix与Spring Cloud Consul）<br>不会单独拿出来分享。</p>
<h2 id="Spring-Cloud-Gateway"><a href="#Spring-Cloud-Gateway" class="headerlink" title="Spring-Cloud-Gateway"></a>Spring-Cloud-Gateway</h2><p>Spring-Cloud-Gateway提供了一个用于在Spring MVC之上构建API网关的库。<br>后面找机会展开学习和分享spring-cloud-gateway。</p>
<h2 id="Spring-Cloud-Stream"><a href="#Spring-Cloud-Stream" class="headerlink" title="Spring-Cloud-Stream"></a>Spring-Cloud-Stream</h2><p>Spring Cloud Stream是基于spring integration框架的一个用于构建与共享消息传递系统相连的高度可扩展的事件驱动的微服务的框架。<br>后面找机会展开学习和分享spring-cloud-stream。</p>
<h2 id="Spring-Cloud-Sleuth"><a href="#Spring-Cloud-Sleuth" class="headerlink" title="Spring-Cloud-Sleuth"></a>Spring-Cloud-Sleuth</h2><p>Spring Cloud Sleuth为Spring Cloud大量借用Dapper，和HTrace实施分布式跟踪的一套解决方案。<br>后面找机会展开学习和分享spring-cloud-sleuth。</p>
<h1 id="spring-cloud商业公司部分"><a href="#spring-cloud商业公司部分" class="headerlink" title="spring-cloud商业公司部分"></a>spring-cloud商业公司部分</h1><h2 id="spring-cloud-netfix"><a href="#spring-cloud-netfix" class="headerlink" title="spring-cloud-netfix"></a>spring-cloud-netfix</h2><p>Spring Cloud Netflix通过自动配置、Spring环境、其他Spring编程模型等技术为Spring Boot应用程序提供Netflix OSS集成。<br>这家公司很良心，后面找机会展开学习和分享spring-cloud-netfix。</p>
<h2 id="spring-cloud-aws"><a href="#spring-cloud-aws" class="headerlink" title="spring-cloud-aws"></a>spring-cloud-aws</h2><p>spring-cloud-aws是为更好的集成aws而提供的一套spring框架。没有机会上aws云，就不入坑了。</p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p><img src="https://jxdw.github.io/img/program/java/chongxinrenshi_springframework.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/10/28/rpc_service_expose_http/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/10/28/rpc_service_expose_http/" class="post-title-link" itemprop="url">【java框架系列】spring boot将rpc服务的业务逻辑暴露成http服务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-28 19:41:34 19:41:34" itemprop="dateCreated datePublished" datetime="2017-10-28T19:41:34+08:00">2017-10-28 19:41:34</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-18 08:17:10 08:17:10" itemprop="dateModified" datetime="2020-10-18T08:17:10+08:00">2020-10-18 08:17:10</time>
      </span>

  
    <span id="/2017/10/28/rpc_service_expose_http/" class="post-meta-item leancloud_visitors" data-flag-title="【java框架系列】spring boot将rpc服务的业务逻辑暴露成http服务" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/10/28/rpc_service_expose_http/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/10/28/rpc_service_expose_http/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="本文参考资料"><a href="#本文参考资料" class="headerlink" title="本文参考资料"></a>本文参考资料</h1><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5908a811da2f60005d188aee">https://juejin.im/post/5908a811da2f60005d188aee</a></p>
<h1 id="定义数据模型"><a href="#定义数据模型" class="headerlink" title="定义数据模型"></a>定义数据模型</h1><h2 id="请求协议"><a href="#请求协议" class="headerlink" title="请求协议"></a>请求协议</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">请求url：http:&#x2F;&#x2F;url&#x2F;接口&#x2F;方法</span><br><span class="line">请求参数：param:&#123;json串&#125;</span><br></pre></td></tr></table></figure>

<h2 id="服务端对请求的封装"><a href="#服务端对请求的封装" class="headerlink" title="服务端对请求的封装"></a>服务端对请求的封装</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class HttpRequest &#123;</span><br><span class="line">    private String param;</span><br><span class="line">    private String service;</span><br><span class="line">    private String method;</span><br><span class="line">	set&#x2F;get方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="服务端的通用应答"><a href="#服务端的通用应答" class="headerlink" title="服务端的通用应答"></a>服务端的通用应答</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class HttpResponse implements Serializable &#123;</span><br><span class="line">    private boolean success;</span><br><span class="line">    private String code;</span><br><span class="line">    private  String description;</span><br><span class="line">	set&#x2F;get方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h1><h2 id="application-yml配置"><a href="#application-yml配置" class="headerlink" title="application.yml配置"></a>application.yml配置</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">conf:</span><br><span class="line">  package: com.jxdw.dubbo.service</span><br><span class="line">&#96;&#96;&#96;  </span><br><span class="line">## 配置类</span><br></pre></td></tr></table></figure>
<p>@Component<br>public class HttpProviderConf {</p>
<pre><code>@Value(&quot;$&#123;conf.package&#125;&quot;)
private String usePackageString;
private  List&lt;String&gt; userPackage;

public List&lt;String&gt; getUserPackage() &#123;
    return userPackage;
&#125;

public void setUserPackage(List&lt;String&gt; userPackage) &#123;
    this.userPackage =Arrays.asList(StringUtils.split(usePackageString,&quot;,&quot;));
&#125;</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## 业务类</span><br></pre></td></tr></table></figure>
<p>import com.alibaba.fastjson.JSON;<br>import com.jxdw.config.HttpProviderConf;<br>import com.jxdw.config.HttpRequest;<br>import com.jxdw.config.HttpResponse;<br>import org.slf4j.Logger;<br>import org.slf4j.LoggerFactory;<br>import org.springframework.beans.BeansException;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.context.ApplicationContext;<br>import org.springframework.context.ApplicationContextAware;<br>import org.springframework.stereotype.Controller;<br>import org.springframework.util.CollectionUtils;<br>import org.springframework.web.bind.annotation.PathVariable;<br>import org.springframework.web.bind.annotation.RequestMapping;<br>import org.springframework.web.bind.annotation.RequestMethod;<br>import org.springframework.web.bind.annotation.ResponseBody;</p>
<p>import javax.servlet.http.HttpServletRequest;<br>import java.lang.reflect.InvocationTargetException;<br>import java.lang.reflect.Method;<br>import java.net.InetAddress;<br>import java.net.UnknownHostException;<br>import java.util.HashMap;<br>import java.util.Map;</p>
<p>@Controller<br>@RequestMapping(“/ThriftAPI”)<br>public class ThriftServiceController implements ApplicationContextAware {</p>
<pre><code>private final static Logger logger= LoggerFactory.getLogger(ThriftServiceController.class);

private ApplicationContext applicationContext;

@Autowired
private HttpProviderConf httpProviderConf;
private final Map&lt;String, Class&lt;?&gt;&gt; cacheMap = new HashMap&lt;String, Class&lt;?&gt;&gt;();

@Override
public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123;
    this.applicationContext=applicationContext;
&#125;

@ResponseBody
@RequestMapping(value = &quot;/&#123;service&#125;/&#123;method&#125;&quot;,method = RequestMethod.POST)
public String api(HttpServletRequest httpServletRequest, HttpRequest httpRequest,
                  @PathVariable String service, @PathVariable String method)&#123;
    logger.info(&quot;ip-&#123;&#125;,http-request &#123;&#125;&quot;,getIp(httpServletRequest), JSON.toJSONString(httpRequest));
    String invoke= invoke(httpRequest,service,method);
    logger.info(&quot;callback &#123;&#125;&quot;,invoke);
    return invoke;
&#125;

private String invoke(HttpRequest httpRequest, String service, String method)  &#123;
    httpRequest.setMethod(method);
    httpRequest.setService(service);
    HttpResponse httpResponse=new HttpResponse();
    if (!CollectionUtils.isEmpty(httpProviderConf.getUserPackage()))&#123;
        boolean isPac=false;
        for(String pac:httpProviderConf.getUserPackage())&#123;
            if(service.startsWith(pac))&#123;
                isPac=true;
                break;
            &#125;
        &#125;
        if (!isPac)&#123;
            logger.error(&quot;service is not  correct service is &#123;&#125;&quot;,service);
            httpResponse.setCode(&quot;2&quot;);
            httpResponse.setSuccess(false);
            httpResponse.setDescription(&quot;service is not conrect&quot;);
        &#125;
    &#125;
    Class&lt;?&gt; serviceClass=cacheMap.get(service);
    if (serviceClass==null)&#123;
        try &#123;
            serviceClass=Class.forName(service);
            cacheMap.put(service,serviceClass);
        &#125; catch (ClassNotFoundException e) &#123;
            e.printStackTrace();
        &#125;
    &#125;
    if (method == null)&#123;
        logger.error(&quot;method is not correct,method=&quot;+method);
        httpResponse.setCode(&quot;2&quot;);
        httpResponse.setSuccess(false);
        httpResponse.setDescription(&quot;method is not correct,method=&quot;+method);
    &#125;
    Method[] methodArray=serviceClass.getMethods();
    Method targetMethod=null;
    Boolean isMethod=false;
    for (Method method1:methodArray)&#123;
        if (method1.getName().equals(method))&#123;
            targetMethod=method1;
            isMethod=true;
            break;
        &#125;
    &#125;
    if (!isMethod)&#123;
        logger.error(&quot;method is not correct,method=&quot;+method);
        httpResponse.setCode(&quot;3&quot;);
        httpResponse.setSuccess(false);
        httpResponse.setDescription(&quot;method is not correct,method=&quot;+method);
        return JSON.toJSONString(httpResponse);
    &#125;
    Object  bean=this.applicationContext.getBean(serviceClass);
    Object result=null;
    if (targetMethod!=null)&#123;
        Class&lt;?&gt;[] parameterTypes=targetMethod.getParameterTypes();
        try&#123;
            if (parameterTypes.length==0)&#123;
                result=targetMethod.invoke(bean);
                return JSON.toJSONString(result);
            &#125;else if(parameterTypes.length==1)&#123;
                Object json=JSON.parseObject(httpRequest.getParam(),parameterTypes[0]);
                result=targetMethod.invoke(bean,json);
                return JSON.toJSONString(result);
            &#125;else &#123;
                logger.error(&quot;can only have one parameter&quot;);
                httpResponse.setCode(&quot;2&quot;);
                httpResponse.setSuccess(false);
                httpResponse.setDescription(&quot;can only have one parameter&quot;);
            &#125;
        &#125;
        catch (InvocationTargetException inException)&#123;
            logger.error(&quot;&#123;&#125;&quot;,inException);
        &#125;catch(IllegalAccessException illException)&#123;
            logger.error(&quot;&#123;&#125;&quot;,illException);
        &#125;
        return JSON.toJSONString(httpResponse);
    &#125;
    return null;
&#125;

private Object getIp(HttpServletRequest httpServletRequest) &#123;
    if (httpServletRequest == null)
        return null;
    String s = httpServletRequest.getHeader(&quot;X-Forwarded-For&quot;);
    if (s == null || s.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(s)) &#123;
        s = httpServletRequest.getHeader(&quot;Proxy-Client-IP&quot;);
    &#125;
    if (s == null || s.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(s)) &#123;
        s = httpServletRequest.getHeader(&quot;WL-Proxy-Client-IP&quot;);
    &#125;
    if (s == null || s.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(s)) &#123;
        s = httpServletRequest.getHeader(&quot;HTTP_CLIENT_IP&quot;);
    &#125;
    if (s == null || s.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(s)) &#123;
        s = httpServletRequest.getHeader(&quot;HTTP_X_FORWARDED_FOR&quot;);
    &#125;
    if (s == null || s.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(s)) &#123;
        s = httpServletRequest.getRemoteAddr();
    &#125;
    if (&quot;127.0.0.1&quot;.equals(s) || &quot;0:0:0:0:0:0:0:1&quot;.equals(s))
        try &#123;
            s = InetAddress.getLocalHost().getHostAddress();
        &#125; catch (UnknownHostException unknownhostexception) &#123;
            return &quot;&quot;;
        &#125;
    return s;
&#125;</code></pre>
<p>}</p>
<pre><code>

</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/10/25/centos7-binary-install-software/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/10/25/centos7-binary-install-software/" class="post-title-link" itemprop="url">【操作系统知识体系】centos7二进制安装go sdk和java sdk</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-25 19:45:35 19:45:35" itemprop="dateCreated datePublished" datetime="2017-10-25T19:45:35+08:00">2017-10-25 19:45:35</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-13 22:06:21 22:06:21" itemprop="dateModified" datetime="2020-10-13T22:06:21+08:00">2020-10-13 22:06:21</time>
      </span>

  
    <span id="/2017/10/25/centos7-binary-install-software/" class="post-meta-item leancloud_visitors" data-flag-title="【操作系统知识体系】centos7二进制安装go sdk和java sdk" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/10/25/centos7-binary-install-software/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/10/25/centos7-binary-install-software/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="安装go-sdk"><a href="#安装go-sdk" class="headerlink" title="安装go sdk"></a>安装go sdk</h1><h2 id="下载二进制包和解压"><a href="#下载二进制包和解压" class="headerlink" title="下载二进制包和解压"></a>下载二进制包和解压</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;dl.google.com&#x2F;go&#x2F;go1.8.4.linux-amd64.tar.gz (访问不了，可能要搭梯子)</span><br><span class="line">tar zxvf go1.8.4.linux-amd64.tar.gz -C &#x2F;usr&#x2F;local&#x2F;</span><br></pre></td></tr></table></figure>

<h2 id="配置profile"><a href="#配置profile" class="headerlink" title="配置profile"></a>配置profile</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p &#x2F;data&#x2F;server&#x2F;go_program</span><br></pre></td></tr></table></figure>

<p>vim /etc/profile</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GOPATH&#x3D;&#x2F;data&#x2F;server&#x2F;go_program</span><br><span class="line">GOROOT&#x3D;&#x2F;usr&#x2F;local&#x2F;go</span><br><span class="line">GOBIN&#x3D;&#x2F;usr&#x2F;local&#x2F;go&#x2F;bin</span><br><span class="line">export PATH&#x3D;$PATH:$GOBIN</span><br></pre></td></tr></table></figure>
<p>然后执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<h1 id="安装java-sdk"><a href="#安装java-sdk" class="headerlink" title="安装java sdk"></a>安装java sdk</h1><h2 id="注册一个oracle账号"><a href="#注册一个oracle账号" class="headerlink" title="注册一个oracle账号"></a>注册一个oracle账号</h2><p>直接到官网上注册一个。</p>
<h2 id="下载二进制包"><a href="#下载二进制包" class="headerlink" title="下载二进制包"></a>下载二进制包</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;download.oracle.com&#x2F;otn&#x2F;java&#x2F;jdk&#x2F;8u102-b14&#x2F;jdk-8u102-linux-x64.tar.gz?AuthParam&#x3D;1556950816_9e12f84633d6ef39d26f9c17c827a965</span><br><span class="line">mv jdk-8u102-linux-x64.tar.gz?AuthParam&#x3D;1556950816_9e12f84633d6ef39d26f9c17c827a965 jdk-8u102-linux-x64.tar.gz</span><br><span class="line">tar zxvf jdk-8u102-linux-x64.tar.gz -C &#x2F;usr&#x2F;local&#x2F;  </span><br></pre></td></tr></table></figure>

<h2 id="解压和配置profile"><a href="#解压和配置profile" class="headerlink" title="解压和配置profile"></a>解压和配置profile</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;jdk1.8.0_161  </span><br><span class="line">export JRE_HOME&#x3D;$JAVA_HOME&#x2F;jre                </span><br><span class="line">export CLASS_PATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin:$JRE_HOME&#x2F;bin</span><br></pre></td></tr></table></figure>
<p>然后执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/10/21/java-spring-boot-1x-talk-about_boot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/10/21/java-spring-boot-1x-talk-about_boot/" class="post-title-link" itemprop="url">【java框架系列】spring boot阶段性总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-21 11:28:53 11:28:53" itemprop="dateCreated datePublished" datetime="2017-10-21T11:28:53+08:00">2017-10-21 11:28:53</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-13 22:09:22 22:09:22" itemprop="dateModified" datetime="2020-10-13T22:09:22+08:00">2020-10-13 22:09:22</time>
      </span>

  
    <span id="/2017/10/21/java-spring-boot-1x-talk-about_boot/" class="post-meta-item leancloud_visitors" data-flag-title="【java框架系列】spring boot阶段性总结" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/10/21/java-spring-boot-1x-talk-about_boot/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/10/21/java-spring-boot-1x-talk-about_boot/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="本文背景"><a href="#本文背景" class="headerlink" title="本文背景"></a>本文背景</h2><p>从2016年接触，2017年全面升级到spring boot，差不多也有一段时间了。spring boot也升级了多个版本。</p>
<h2 id="准备资料"><a href="#准备资料" class="headerlink" title="准备资料"></a>准备资料</h2><p>官方blog: <a target="_blank" rel="noopener" href="https://spring.io/blog/2017/10/17/spring-boot-1-5-8-available-now">https://spring.io/blog/2017/10/17/spring-boot-1-5-8-available-now</a><br>官方文档: <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/1.5.8.RELEASE/reference/pdf/spring-boot-reference.pdf">https://docs.spring.io/spring-boot/docs/1.5.8.RELEASE/reference/pdf/spring-boot-reference.pdf</a></p>
<h2 id="关于spring-boot-1-X系列"><a href="#关于spring-boot-1-X系列" class="headerlink" title="关于spring boot 1.X系列"></a>关于spring boot 1.X系列</h2><p>spring.io在spring boot和springcloud推出之前，开源了很多的框架（见下文附录），但是除了spring framework自身，影响力都不够。直到spring boot、spring cloud系列框架推出，才成了spring框架的扩展中最有影响力的两个(或者说集大成者)。<br>Spring Boot的设计目的是用来简化新Spring应用的初始搭建以及开发过程。该框架使用了特定的方式来进行配置，从而使开发人员不再需要定义样板化的配置。<br>通俗点理解，就是spring boot其实不是什么新的框架，它默认配置了很多框架的使用方式，就像maven整合了很多的jar包，比如散落在各处的spring框架：spring amqp、spring data redis client、spring web service，进而集大成。<br>Spring Cloud为开发人员提供了快速构建分布式系统中一些常见模式的工具，例如配置管理，服务发现，断路器，智能路由，微代理，控制总线，一次性令牌，全局锁定，领导选举，分布式会话，集群状态。<br>从技术实现上来说，也是集成开源届的各种方案比如 client、rabbitmq client、eureka client。</p>
<h1 id="spring-boot-1-5-X版本"><a href="#spring-boot-1-5-X版本" class="headerlink" title="spring boot 1.5.X版本"></a>spring boot 1.5.X版本</h1><h2 id="版本特性"><a href="#版本特性" class="headerlink" title="版本特性"></a>版本特性</h2><p>我们看下官方文档中的spring boot1.5.X版本的特性：</p>
<ul>
<li>springApplication（这个肯定得用）</li>
<li>Externalized Configuration（这个肯定得用）</li>
<li>profile（这个不怎么用）</li>
<li>logging（这个不怎么用）</li>
<li>develop web application（这个肯定得用）</li>
<li>Security（这个没有怎么用）</li>
<li>Working with SQL databases（这个没有怎么用）</li>
<li>Working with NoSQL technologies（这个没怎么用）</li>
<li>caching（这个肯定得用）</li>
<li>messaging（这个肯定得用）</li>
<li>Calling REST services（这个没用）</li>
<li>Validation（这个没用）</li>
<li>Sending email（这个没用）</li>
<li>Distributed Transactions with JTA（这个没用）</li>
<li>Spring Integration（这个肯定得用）</li>
<li>Spring Session（这个没用）</li>
<li>Monitoring and management over JMX（这个没用）</li>
<li>Testing（这个肯定得用）</li>
<li>websocket（这个没用）</li>
<li>web services（这个没用）</li>
<li>Spring Boot Actuator: Production-ready features（这个没用，其实要用了，就没啥自定义开发啥事了）</li>
</ul>
<h2 id="源码预览"><a href="#源码预览" class="headerlink" title="源码预览"></a>源码预览</h2><p><img src="https://jxdw.github.io/img/program/java/spring_boot_source_code_yulan_2.png"><br><img src="https://jxdw.github.io/img/program/java/spring_boot_source_code_yulan.png"></p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p><img src="https://jxdw.github.io/img/program/java/chongxinrenshi_springframework.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/08/30/centos7-self-shell-reboot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/08/30/centos7-self-shell-reboot/" class="post-title-link" itemprop="url">【操作系统知识体系】centos7下自定义脚本开机自启动</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-08-30 12:31:17 12:31:17" itemprop="dateCreated datePublished" datetime="2017-08-30T12:31:17+08:00">2017-08-30 12:31:17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-13 22:06:21 22:06:21" itemprop="dateModified" datetime="2020-10-13T22:06:21+08:00">2020-10-13 22:06:21</time>
      </span>

  
    <span id="/2017/08/30/centos7-self-shell-reboot/" class="post-meta-item leancloud_visitors" data-flag-title="【操作系统知识体系】centos7下自定义脚本开机自启动" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/08/30/centos7-self-shell-reboot/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/08/30/centos7-self-shell-reboot/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h1><p>本命令可能很久才会用一次</p>
<h1 id="修改-etc-rc-local"><a href="#修改-etc-rc-local" class="headerlink" title="修改/etc/rc.local"></a>修改/etc/rc.local</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span><br><span class="line">#</span><br><span class="line"># It is highly advisable to create own systemd services or udev rules</span><br><span class="line"># to run scripts during boot instead of using this file.</span><br><span class="line">#</span><br><span class="line"># In contrast to previous versions due to parallel execution during boot</span><br><span class="line"># this script will NOT be run after all other services.</span><br><span class="line">#</span><br><span class="line"># Please note that you must run &#39;chmod +x &#x2F;etc&#x2F;rc.d&#x2F;rc.local&#39; to ensure</span><br><span class="line"># that this script will be executed during boot.</span><br><span class="line"></span><br><span class="line">touch &#x2F;var&#x2F;lock&#x2F;subsys&#x2F;local</span><br><span class="line">&#x2F;bin&#x2F;su - zookeeper -c &quot;&#x2F;data&#x2F;zookeeper&#x2F;bin&#x2F;zkServer.sh start &amp;&quot; # 启动zookeeper服务</span><br><span class="line">docker ps -a|awk &#39;&#123;print $1&#125;&#39;|xargs docker start #重启docker里面的服务</span><br><span class="line">&#x2F;bin&#x2F;su - bbs_abc  -c &quot;&#x2F;data&#x2F;server&#x2F;bbs&#x2F;abc&#x2F;bin&#x2F;server.sh restart &amp;&quot;</span><br></pre></td></tr></table></figure>

<h1 id="给-etc-rc-d-rc-local执行权限"><a href="#给-etc-rc-d-rc-local执行权限" class="headerlink" title="给/etc/rc.d/rc.local执行权限"></a>给/etc/rc.d/rc.local执行权限</h1><p>chmod a+x /etc/rc.d/rc.local</p>
<h1 id="reboot查看效果"><a href="#reboot查看效果" class="headerlink" title="reboot查看效果"></a>reboot查看效果</h1><p>服务已经启动了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/08/05/centos7-install-software/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/08/05/centos7-install-software/" class="post-title-link" itemprop="url">【操作系统知识体系】玩转centos7之程序安装与启动(rpm、yum、systemd)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-08-05 21:11:16 21:11:16" itemprop="dateCreated datePublished" datetime="2017-08-05T21:11:16+08:00">2017-08-05 21:11:16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-13 22:06:21 22:06:21" itemprop="dateModified" datetime="2020-10-13T22:06:21+08:00">2020-10-13 22:06:21</time>
      </span>

  
    <span id="/2017/08/05/centos7-install-software/" class="post-meta-item leancloud_visitors" data-flag-title="【操作系统知识体系】玩转centos7之程序安装与启动(rpm、yum、systemd)" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/08/05/centos7-install-software/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/08/05/centos7-install-software/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h1><p><font color="red">进行下面的操作前，最好修改下dns(查找速度)：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;resolv.conf</span><br></pre></td></tr></table></figure>
<p>升级curl、nss：<br>yum update nss curl<br></font></p>
<h1 id="程序安装包技术rpm"><a href="#程序安装包技术rpm" class="headerlink" title="程序安装包技术rpm"></a>程序安装包技术rpm</h1><h2 id="rpm包与源码包的对比"><a href="#rpm包与源码包的对比" class="headerlink" title="rpm包与源码包的对比"></a>rpm包与源码包的对比</h2><p><img src="https://jxdw.github.io/img/devops/centos7/rpm_vs_sourcecode.png"></p>
<h2 id="rpm-help命令"><a href="#rpm-help命令" class="headerlink" title="rpm help命令"></a>rpm help命令</h2><p><img src="https://jxdw.github.io/img/devops/centos7/rpm_man.png"></p>
<h2 id="本机已安装的包"><a href="#本机已安装的包" class="headerlink" title="本机已安装的包"></a>本机已安装的包</h2><p><img src="https://jxdw.github.io/img/devops/centos7/rpm_qa.png"></p>
<h1 id="程序安装关键技术yum"><a href="#程序安装关键技术yum" class="headerlink" title="程序安装关键技术yum"></a>程序安装关键技术yum</h1><h2 id="repo概念"><a href="#repo概念" class="headerlink" title="repo概念"></a>repo概念</h2><p>repo文件是Fedora中yum源（软件仓库）的配置文件，通常一个repo文件定义了一个或者多个软件仓库的细节内容。<br>例如<font color="red">我们将从哪里下载需要安装或者升级的软件包</font>，repo文件中的设置内容将被yum读取和应用！<br>更多的源介绍，可以参考: <a href="https://jxdw.github.io/2017/08/05/centos7-repo-introduce/">https://jxdw.github.io/2017/08/05/centos7-repo-introduce/</a></p>
<h2 id="yum介绍"><a href="#yum介绍" class="headerlink" title="yum介绍"></a>yum介绍</h2><p>yum(Yellow dog Updater, Modified)是一个在Fedora和RedHat以及SUSE中的Shell前端软件包管理器。<br>基于RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软体包，无须繁琐地一次次下载、安装。<br>yum提供了查找、安装、删除某一个、一组甚至全部软件包的命令，而且命令简洁而又好记。<br>YUM的工作原理并不复杂，每一个 RPM软件的头（header）里面都会纪录该软件的依赖关系，那么如果可以将该头的内容纪录下来并且进行分析，可以知道每个软件在安装之前需要额外安装 哪些基础软件。<br>也就是说，在服务器上面先以分析工具将所有的RPM档案进行分析，然后将该分析纪录下来，只要在进行安装或升级时先查询该纪录的文件，就可以知道所有相关联的软件。<br><img src="https://jxdw.github.io/img/devops/centos7/yum_introduce.png"></p>
<h2 id="yum配置文件解析"><a href="#yum配置文件解析" class="headerlink" title="yum配置文件解析"></a>yum配置文件解析</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;yum.conf</span><br><span class="line">[main]</span><br><span class="line">cachedir&#x3D;&#x2F;var&#x2F;cache&#x2F;yum&#x2F;$basearch&#x2F;$releasever</span><br><span class="line">keepcache&#x3D;0</span><br><span class="line">debuglevel&#x3D;2</span><br><span class="line">logfile&#x3D;&#x2F;var&#x2F;log&#x2F;yum.log</span><br><span class="line">exactarch&#x3D;1</span><br><span class="line">obsoletes&#x3D;1</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">plugins&#x3D;1</span><br><span class="line">installonly_limit&#x3D;5</span><br><span class="line">bugtracker_url&#x3D;http:&#x2F;&#x2F;bugs.centos.org&#x2F;set_project.php?project_id&#x3D;23&amp;ref&#x3D;http:&#x2F;&#x2F;bugs.centos.org&#x2F;bug_report_page.php?category&#x3D;yum</span><br><span class="line">distroverpkg&#x3D;centos-release</span><br></pre></td></tr></table></figure>
<p>各个文件存放在/etc/yum.repos.d目录下。</p>
<h2 id="更换yum源"><a href="#更换yum源" class="headerlink" title="更换yum源"></a>更换yum源</h2><p>一直有一个现实的问题：<font color="red">在国内下载某些国外的软件会很慢。所以，一般会选择aliyun或者163的源仓库。</font><br>更换步骤：</p>
<h3 id="备份原来的yum源"><a href="#备份原来的yum源" class="headerlink" title="备份原来的yum源"></a>备份原来的yum源</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo.bak </span><br></pre></td></tr></table></figure>

<h3 id="设置aliyun的yum源"><a href="#设置aliyun的yum源" class="headerlink" title="设置aliyun的yum源"></a>设置aliyun的yum源</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo </span><br></pre></td></tr></table></figure>

<h3 id="添加EPEL源"><a href="#添加EPEL源" class="headerlink" title="添加EPEL源"></a>添加EPEL源</h3><p>EPEL (<a target="_blank" rel="noopener" href="http://fedoraproject.org/wiki/EPEL">http://fedoraproject.org/wiki/EPEL</a>) 是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。<br>装上 EPEL后，可以像在 Fedora 上一样，可以通过 yum install package-name，安装更多软件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget -P &#x2F;etc&#x2F;yum.repos.d&#x2F; http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo </span><br></pre></td></tr></table></figure>

<h3 id="清理缓存并生成新的缓存"><a href="#清理缓存并生成新的缓存" class="headerlink" title="清理缓存并生成新的缓存"></a>清理缓存并生成新的缓存</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum clean all  </span><br><span class="line">yum makecache </span><br></pre></td></tr></table></figure>
<h3 id="其他的源"><a href="#其他的源" class="headerlink" title="其他的源"></a>其他的源</h3><p><font color="red">暂时不需要更新内核，所以，就不用装elrepo源。</font><br>自此，结束。</p>
<h2 id="yum其他命令"><a href="#yum其他命令" class="headerlink" title="yum其他命令"></a>yum其他命令</h2><p>输入man yum可以看到参考手册：<br><img src="https://jxdw.github.io/img/devops/centos7/yum_introduce.png"></p>
<h1 id="程序启动关键技术systemd"><a href="#程序启动关键技术systemd" class="headerlink" title="程序启动关键技术systemd"></a>程序启动关键技术systemd</h1><h2 id="systemd的历史"><a href="#systemd的历史" class="headerlink" title="systemd的历史"></a>systemd的历史</h2><p>Systemd目的是要取代Unix时代以来一直在使用的init系统，兼容SysV和LSB的启动脚本，而且够在进程启动过程中更有效地引导加载服务。<br>Systemd的很多概念来源于苹果Mac OS操作系统上的launchd，不过launchd专用于苹果系统，因此长期未能获得应有的广泛关注。Systemd借鉴了很多launchd的思想。<br>Systemd是Linux系统中最新的初始化系统（init），它主要的设计目标是克服SysV init 固有的缺点，提高系统的启动速度。<br>systemd和ubuntu的upstart 是竞争对手，预计会取代 UpStart，然而在Ubuntu 15.04采用systemd作为默认引导程序，debian8也开始使用systemd。足以看出systemd的流行度。</p>
<h2 id="systemd的特点"><a href="#systemd的特点" class="headerlink" title="systemd的特点"></a>systemd的特点</h2><p>CentOS 7使用systemd替换了SysV。下面是一些特别要注意的和之前主要版本的RHEL不再兼容的部分。<br>1.systemd对运行级别支持有限<br>为了保存兼容，systemd提供一定数量的target单元，可以直接和运行级别对应，也可以被早期的分布式的运行级别命令支持。不是所有的target都可以被映射到运行级别，在这种情况下，使用runlevel命令有可能会返回一个为N的不知道的运行级别，所以推荐尽量避免在RHEL7中使用runlevel命令。</p>
<p>2.systemd不支持像init脚本那样的个性化命令。<br>除了一些标准命令参数例如：start、stop、status，SysV init脚本可以根据需要支持想要的任何参数，通过参数提供附加的功能，因为SysV init的服务器脚本实际上就是shell脚本，命令参数实际上就是shell子函数。举个例子，RHEL6的iptables服务脚本可以执行panic命令行参数，这个参数可以让系统立即进入紧急模式，丢弃所有的进入和发出的数据包。但是类似这样的命令行参数在systemd中是不支持的，systemd只支持在配置文件中指定命令行参数。</p>
<p>3.systemd不支持和没有从systemd启动的服务通讯<br>当systemd启动服务的时候，他保存进程的主ID以便于追踪，systemctl工具使用进程PID查询和管理服务。相反的，如果用户从命令行启动特定的服务，systemctl命令是没有办法判断这个服务的状态是启动还是运行的。</p>
<p>4.systemd可以只停止运行的服务<br>在RHEL6及之前的版本，当关闭系统的程序启动之后，RHEL6的系统会执行/etc/rc0.d/下所有服务脚本的关闭操作，不管服务是处于运行或者根本没有运行的状态。而systemd可以做到只关闭在运行的服务，这样可以大大节省关机的时间。</p>
<p>5.不能从标准输出设备读到系统服务信息。<br>systemd启动服务的时候，将标准输出信息定向到/dev/null，以免打扰用户。</p>
<p>6.systemd不继承任何上下文环境。<br>systemd不继承任何上下文环境，如用户或者会话的HOME或者PATH的环境变量。每个服务得到的是干净的上下文环境。</p>
<p>7.SysV init脚本依赖性。<br>当systemd启动SysV init脚本，systemd在运行的时候，从LinuxStandardBase(LSB)Linux标准库头文件读取服务的依赖信息并继承。</p>
<p>8.超时机制。<br>为了防止系统被卡住，所有的服务有5分钟的超时机制。</p>
<h2 id="systemd的架构和优缺点"><a href="#systemd的架构和优缺点" class="headerlink" title="systemd的架构和优缺点"></a>systemd的架构和优缺点</h2><p>Systemd 的优点是功能强大，使用方便，缺点是体系庞大，非常复杂。<br>事实上，现在还有很多人反对使用 Systemd，理由就是它过于复杂，与操作系统的其他部分强耦合，违反”keep simple, keep stupid”的Unix 哲学。<br>下图是systemd的架构图（图片来自网络）：<br><img src="https://jxdw.github.io/img/devops/centos7/2016062508410641.png"></p>
<h2 id="systemd的概念模型"><a href="#systemd的概念模型" class="headerlink" title="systemd的概念模型"></a>systemd的概念模型</h2><h3 id="单元的概念"><a href="#单元的概念" class="headerlink" title="单元的概念"></a>单元的概念</h3><p>在RHEL7之前，服务管理是分布式的被SysV init或UpStart通过/etc/rc.d/init.d下的脚本管理。这些脚本是经典的Bash脚本，允许管理员控制服务的状态。在RHEL7中，这些脚本被服务单元文件替换。<br>系统初始化需要做的事情非常多。需要启动后台服务，比如启动 SSHD 服务；需要做配置工作，比如挂载文件系统。这个过程中的每一步都被 systemd 抽象为一个配置单元，即 unit。Systemd可以管理所有系统资源。不同的资源统称为 Unit（单位）。可以认为一个服务是一个配置单元；一个挂载点是一个配置单元；一个交换分区的配置是一个配置单元；等等。systemd 将配置单元归纳为以下一些不同的类型。然而，systemd 正在快速发展，新功能不断增加。所以配置单元类型可能在不久的将来继续增加。systemd中有许多单元类型，服务单元文件的扩展名是.service，同脚本的功能相似。例如有查看、启动、停止、重启、启用或者禁止服务的参数。<br>下面说明下，systemd单元文件放置位置：<br>/run/systemd/system #单元运行时创建，这个目录优先于按照目录<br>/etc/systemd/system #系统管理员创建和管理的单元目录，优先级最高<br>/usr/lib/systemd/system/system #默认单元文件安装目录<br>有了对systemd的基本认识后，下面就开始来介绍相关的操作命令。但是注意一点，systemd并不是一个命令，而是一组命令，涉及到系统管理的方方面面。</p>
<h2 id="systemd命令"><a href="#systemd命令" class="headerlink" title="systemd命令"></a>systemd命令</h2><p>1.查看当前系统的所有Unit</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl list-units #列出正在运行的Unit</span><br><span class="line">systemctl list-units --all #列出所有Unit，包括没有找到配置文件的或者启动失败的</span><br><span class="line">systemctl list-units --all --state&#x3D;inactive #列出所有没有运行的Unit</span><br><span class="line">systemctl list-units --failed #列出所有加载失败的Unit</span><br><span class="line">systemctl list-units --type&#x3D;service #列出所有正在运行的、类型为service的Unit</span><br></pre></td></tr></table></figure>

<p>2.unit.service管理命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl start name.service #启动一个服务</span><br><span class="line">systemctl stop name.service #关闭一个服务</span><br><span class="line">systemctl restart name.service #重启一个服务</span><br><span class="line">systemctl reload name.service #重载一个服务</span><br><span class="line">systemctl try-restart name.service #仅当服务运行的时候，重启服务</span><br><span class="line">systemctl kill name.service # 杀死一个服务的所有子进程</span><br><span class="line">systemctl daemon-reload #重载所有修改过的配置文件</span><br><span class="line">systemctl enable name.service #允许服务开机启动</span><br><span class="line">systemclt disable name.service #禁止服务开机启动</span><br><span class="line">systemctl list-dependencies nginx.service #命令列出一个Unit的所有依赖</span><br><span class="line">systemctl show httpd.service #显示某个Unit的所有底层参数</span><br><span class="line">systemctl show -p CPUShares httpd.service #显示某个Unit的指定属性的值</span><br><span class="line">systemctl set-property httpd.service CPUShares&#x3D;500 # 设置某个Unit的指定属性</span><br></pre></td></tr></table></figure>

<p>3.电源管理命令（systemctl）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl reboot         #重启机器</span><br><span class="line">systemctl poweroff       #关机</span><br><span class="line">systemctl suspend        #待机</span><br><span class="line">systemctl hibernate      #休眠</span><br><span class="line">systemctl hybrid-sleep   #混合休眠模式（同时休眠到硬盘并待机）</span><br></pre></td></tr></table></figure>
<p>4.系统引导性能分析命令（systemd-analyze）</p>
<p>5.systemd的日志服务<br>systemd 自带日志服务 journald，该日志服务的设计初衷是克服现有的 syslog 服务的缺点。比如：syslog不安全，消息的内容无法验证。每一个本地进程都可以声称自己是 Apache PID 4711，而 syslog 也就相信并保存到磁盘上。数据没有严格的格式，非常随意。自动化的日志分析器需要分析人类语言字符串来识别消息。一方面此类分析困难低效；此外日志格式的变化会导致分析代码需要更新甚至重写。<br>Systemd Journal 用二进制格式保存所有日志信息，用户使用 journalctl 命令来查看日志信息。无需自己编写复杂脆弱的字符串分析处理程序。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">journalctl #查看所有日志（默认情况下 ，只保存本次启动的日志）</span><br><span class="line">journalctl -k #查看内核日志（不显示应用日志）</span><br><span class="line">journalctl -b #查看系统本次启动的日志</span><br><span class="line">journalctl -b -0</span><br><span class="line">journalctl -b -1 # 查看上一次启动的日志（需更改设置）</span><br><span class="line">journalctl --since&#x3D;&quot;2012-10-30 18:17:16&quot; # 查看指定时间的日志</span><br><span class="line">journalctl --since &quot;20 min ago&quot; # 查看指定时间的日志</span><br><span class="line">journalctl --since yesterday # 查看指定时间的日志</span><br><span class="line">journalctl --since &quot;2015-01-10&quot; --until &quot;2015-01-11 03:00&quot; # 查看指定时间的日志</span><br><span class="line">journalctl --since 09:00 --until &quot;1 hour ago&quot; # 查看指定时间的日志</span><br><span class="line">journalctl -n # 显示尾部的最新10行日志</span><br><span class="line">journalctl -n 20 # 显示尾部指定行数的日志</span><br><span class="line">journalctl -f # 实时滚动显示最新日志</span><br><span class="line">journalctl &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;systemd # 查看指定服务的日志</span><br><span class="line">journalctl _PID&#x3D;1 # 查看指定进程的日志</span><br><span class="line">journalctl &#x2F;usr&#x2F;bin&#x2F;bash # 查看某个路径的脚本的日志</span><br><span class="line">journalctl _UID&#x3D;33 --since today # 查看指定用户的日志</span><br><span class="line">journalctl -u nginx.service # 查看某个 Unit 的日志</span><br><span class="line">journalctl -u nginx.service --since today</span><br><span class="line">journalctl -u nginx.service -f # 实时滚动显示某个 Unit 的最新日志</span><br><span class="line">journalctl -u nginx.service -u php-fpm.service --since today # 合并显示多个 Unit 的日志</span><br><span class="line">journalctl -p err -b # 查看指定优先级（及其以上级别）的日志，共有8级-0: emerg、1: alert、2: crit、3: err、4: warning、5: notice、6: info、7: debug</span><br><span class="line">journalctl --no-pager # 日志默认分页输出，--no-pager 改为正常的标准输出</span><br><span class="line">journalctl -b -u nginx.service -o json # 以JSON格式（单行）输出</span><br><span class="line">journalctl -b -u nginx.serviceqq -o json-pretty # 以JSON格式（多行）输出，可读性更好</span><br><span class="line">journalctl --disk-usage # 显示日志占据的硬盘空间</span><br><span class="line">journalctl --vacuum-size&#x3D;1G # 指定日志文件占据的最大空间</span><br><span class="line">journalctl --vacuum-time&#x3D;1years # 指定日志文件保存多久</span><br></pre></td></tr></table></figure>

<h2 id="例子-mysqld为例"><a href="#例子-mysqld为例" class="headerlink" title="例子(mysqld为例)"></a>例子(mysqld为例)</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># systemd service file for MySQL forking server</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;MySQL Server</span><br><span class="line">Documentation&#x3D;man:mysqld(8)</span><br><span class="line">Documentation&#x3D;http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;en&#x2F;using-systemd.html</span><br><span class="line">After&#x3D;network.target</span><br><span class="line">After&#x3D;syslog.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br><span class="line">[Service]</span><br><span class="line">User&#x3D;mysql</span><br><span class="line">Group&#x3D;mysql</span><br><span class="line">Type&#x3D;forking</span><br><span class="line">PIDFile&#x3D;&#x2F;data&#x2F;mysql&#x2F;run&#x2F;mysqld.pid</span><br><span class="line"># Disable service start and stop timeout logic of systemd for mysqld service.</span><br><span class="line">TimeoutSec&#x3D;0</span><br><span class="line"># Execute pre and post scripts as root</span><br><span class="line">PermissionsStartOnly&#x3D;true</span><br><span class="line"># Needed to create system tables</span><br><span class="line">#ExecStartPre&#x3D;&#x2F;home&#x2F;bin&#x2F;mysqld_pre_systemd</span><br><span class="line"># Start main service</span><br><span class="line">ExecStart&#x3D;&#x2F;data&#x2F;mysql&#x2F;bin&#x2F;mysqld --daemonize --pid-file&#x3D;&#x2F;data&#x2F;mysql&#x2F;run&#x2F;mysqld.pid $MYSQLD_OPTS</span><br><span class="line"># Use this to switch malloc implementation</span><br><span class="line">EnvironmentFile&#x3D;-&#x2F;etc&#x2F;sysconfig&#x2F;mysq</span><br><span class="line"># Sets open_files_limit</span><br><span class="line">LimitNOFILE &#x3D; 65535</span><br><span class="line">Restart&#x3D;on-failure</span><br><span class="line">RestartPreventExitStatus&#x3D;1</span><br><span class="line">PrivateTmp&#x3D;false</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/08/05/centos7-repo-introduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/08/05/centos7-repo-introduce/" class="post-title-link" itemprop="url">【操作系统知识体系】【转载】centos7源介绍与软件安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-08-05 16:52:46 16:52:46" itemprop="dateCreated datePublished" datetime="2017-08-05T16:52:46+08:00">2017-08-05 16:52:46</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-13 22:06:21 22:06:21" itemprop="dateModified" datetime="2020-10-13T22:06:21+08:00">2020-10-13 22:06:21</time>
      </span>

  
    <span id="/2017/08/05/centos7-repo-introduce/" class="post-meta-item leancloud_visitors" data-flag-title="【操作系统知识体系】【转载】centos7源介绍与软件安装" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/08/05/centos7-repo-introduce/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/08/05/centos7-repo-introduce/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="原文地址"><a href="#原文地址" class="headerlink" title="原文地址"></a>原文地址</h1><p><a target="_blank" rel="noopener" href="http://yinflying.top/2017/03/373">http://yinflying.top/2017/03/373</a></p>
<h1 id="笔记版"><a href="#笔记版" class="headerlink" title="笔记版"></a>笔记版</h1><p><img src="https://jxdw.github.io/img/devops/centos7/centos7_repo.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/08/05/centos7-bootstrap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/08/05/centos7-bootstrap/" class="post-title-link" itemprop="url">【操作系统知识体系】【转载】centos7启动以及systemd详细说明</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-08-05 14:09:32 14:09:32" itemprop="dateCreated datePublished" datetime="2017-08-05T14:09:32+08:00">2017-08-05 14:09:32</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-13 22:06:21 22:06:21" itemprop="dateModified" datetime="2020-10-13T22:06:21+08:00">2020-10-13 22:06:21</time>
      </span>

  
    <span id="/2017/08/05/centos7-bootstrap/" class="post-meta-item leancloud_visitors" data-flag-title="【操作系统知识体系】【转载】centos7启动以及systemd详细说明" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/08/05/centos7-bootstrap/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/08/05/centos7-bootstrap/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="原文地址"><a href="#原文地址" class="headerlink" title="原文地址"></a>原文地址</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mfyang/p/7275966.html">https://www.cnblogs.com/mfyang/p/7275966.html</a></p>
<h1 id="标记版"><a href="#标记版" class="headerlink" title="标记版"></a>标记版</h1><p><img src="https://jxdw.github.io/img/devops/centos7/centos7_bootstrap.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jxdw.github.io/2017/07/21/redis-protocol/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/favicon.png">
      <meta itemprop="name" content="渐学顿悟">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渐学顿悟">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/21/redis-protocol/" class="post-title-link" itemprop="url">【redis使用系列】redis通信协议及与mysql互通</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-07-21 19:58:10 19:58:10" itemprop="dateCreated datePublished" datetime="2017-07-21T19:58:10+08:00">2017-07-21 19:58:10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-13 23:23:37 23:23:37" itemprop="dateModified" datetime="2020-10-13T23:23:37+08:00">2020-10-13 23:23:37</time>
      </span>

  
    <span id="/2017/07/21/redis-protocol/" class="post-meta-item leancloud_visitors" data-flag-title="【redis使用系列】redis通信协议及与mysql互通" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/07/21/redis-protocol/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/07/21/redis-protocol/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="本文参考资料"><a href="#本文参考资料" class="headerlink" title="本文参考资料"></a>本文参考资料</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;redis.io&#x2F;topics&#x2F;protocol</span><br></pre></td></tr></table></figure>

<h1 id="redis-cli命令与redis通信协议"><a href="#redis-cli命令与redis通信协议" class="headerlink" title="redis-cli命令与redis通信协议"></a>redis-cli命令与redis通信协议</h1><h2 id="redis-cli命令"><a href="#redis-cli命令" class="headerlink" title="redis-cli命令"></a>redis-cli命令</h2><p>redis命令在从提交到返回处理结果的过程中，消耗的时间我们称之为RTT（往返时间）。在需要批量执行redis 命令的场景下，如果命令单条逐个执行，那么总共花费的时间是命令条数 N * RTT。redis 提供了管道技术来提高批量执行效率，即将多个命令打包发送给redis服务端，所有命令执行完后，再将所有结果打包返回。在所有命令执行结束前，redis服务器会缓存已执行结束的结果。<br>在redis-cli命令行中，使用redis管道技术时，我们通常将待执行的命令放到一个文本里，比如commands.txt，然后使用命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat commands.txt | redis-cli --pipe</span><br></pre></td></tr></table></figure>
<p>去读取文本里的命令，然后打包已pipe管道的方式发送给redis服务端。<br>其他命令见<img src="https://jxdw.github.io/img/business/redis/redis3.2_clihelpcmand.png"></p>
<h2 id="redis通信协议"><a href="#redis通信协议" class="headerlink" title="redis通信协议"></a>redis通信协议</h2><p>Redis服务器与客户端通过RESP（REdis Serialization Protocol）协议通信。协议用 \r\n 做间隔。对于简单的字符串，以 + 开头，例如 :+OK\r\n。对于错误消息，以 - 开头 ，例如:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-ERR unknown command &#39;foobar&#39;\r\n</span><br><span class="line">-WRONGTYPE Operation against a key holding the wrong kind of value\r\n</span><br></pre></td></tr></table></figure>
<p>对于整数，以:开头，例如:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:100\r\n</span><br></pre></td></tr></table></figure>
<p>对于大字符串，以$开头，接着跟上字符串长度的数字。 最长512MB 。 例如:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$6\r\nfoobar\r\n      代表一个长6的字符串， foobar </span><br><span class="line">$0\r\n\r\n            长度为0 的空字符串</span><br><span class="line">$-1\r\n                Null</span><br></pre></td></tr></table></figure>
<p>对于数组， 以 * 开头， 接上数组元素个数。 加数组元素</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*0\r\n    一个空的数组</span><br><span class="line">*2\r\n$3\r\nfoo\r\n$3\r\nbar\r\n 一个有两个元素的数组   foo  bar </span><br></pre></td></tr></table></figure>
<p>数组可以有更多复杂的用法，具体的建议去看官方文档。此处就不一一介绍了</p>
<h2 id="go与redis通信（2018年补充）"><a href="#go与redis通信（2018年补充）" class="headerlink" title="go与redis通信（2018年补充）"></a>go与redis通信（2018年补充）</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">	tcpAddr, err :&#x3D; net.ResolveTCPAddr(&quot;tcp4&quot;, &quot;10.2.1.30:6379&quot;)</span><br><span class="line">	conn, err :&#x3D; net.DialTCP(&quot;tcp&quot;, nil, tcpAddr)</span><br><span class="line">	if err !&#x3D; nil &#123;</span><br><span class="line">		fmt.Println(err, conn)</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line">	req :&#x3D; &quot;*3\r\n&quot; +</span><br><span class="line">		&quot;$3\r\n&quot; +</span><br><span class="line">		&quot;set\r\n&quot; +</span><br><span class="line">		&quot;$3\r\n&quot; +</span><br><span class="line">		&quot;foo\r\n&quot; +</span><br><span class="line">		&quot;$3\r\n&quot; +</span><br><span class="line">		&quot;bar\r\n&quot;</span><br><span class="line"></span><br><span class="line">	conn.Write([]byte(req))</span><br><span class="line"></span><br><span class="line">	req &#x3D; &quot;*2\r\n&quot; +</span><br><span class="line">		&quot;$3\r\n&quot; +</span><br><span class="line">		&quot;get\r\n&quot; +</span><br><span class="line">		&quot;$3\r\n&quot; +</span><br><span class="line">		&quot;foo\r\n&quot;</span><br><span class="line"></span><br><span class="line">	buffer :&#x3D; make([]byte, 2048)</span><br><span class="line">	conn.Write([]byte(req))</span><br><span class="line">	time.Sleep(10 * time.Millisecond)</span><br><span class="line">	conn.Read(buffer)</span><br><span class="line">	fmt.Println(string(buffer))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="mysql数据导入redis"><a href="#mysql数据导入redis" class="headerlink" title="mysql数据导入redis"></a>mysql数据导入redis</h1><h2 id="mysql数据导入redis-1"><a href="#mysql数据导入redis-1" class="headerlink" title="mysql数据导入redis"></a>mysql数据导入redis</h2><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DROP TABLE IF EXISTS &#96;t_area&#96;;</span><br><span class="line">CREATE TABLE &#96;t_area&#96; (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;pid&#96; int(11) NOT NULL,</span><br><span class="line">  &#96;areaname&#96; varchar(255) NOT NULL,</span><br><span class="line">  &#96;arealevel&#96; varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;1 DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of t_area</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO &#96;t_area&#96; VALUES (&#39;1&#39;, &#39;0&#39;, &#39;北京&#39;, &#39;0&#39;);</span><br><span class="line">INSERT INTO &#96;t_area&#96; VALUES (&#39;2&#39;, &#39;0&#39;, &#39;上海&#39;, &#39;0&#39;);</span><br><span class="line">INSERT INTO &#96;t_area&#96; VALUES (&#39;3&#39;, &#39;0&#39;, &#39;广州&#39;, &#39;0&#39;);</span><br><span class="line">INSERT INTO &#96;t_area&#96; VALUES (&#39;4&#39;, &#39;0&#39;, &#39;深圳&#39;, &#39;0&#39;);</span><br><span class="line">INSERT INTO &#96;t_area&#96; VALUES (&#39;5&#39;, &#39;0&#39;, &#39;杭州&#39;, &#39;0&#39;);</span><br></pre></td></tr></table></figure>

<h3 id="编写脚本"><a href="#编写脚本" class="headerlink" title="编写脚本"></a>编写脚本</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT CONCAT(</span><br><span class="line">  &quot;*4\r\n&quot;,</span><br><span class="line">  &#39;$&#39;, LENGTH(redis_cmd), &#39;\r\n&#39;,</span><br><span class="line">  redis_cmd, &#39;\r\n&#39;,</span><br><span class="line">  &#39;$&#39;, LENGTH(redis_key), &#39;\r\n&#39;,</span><br><span class="line">  redis_key, &#39;\r\n&#39;,</span><br><span class="line">  &#39;$&#39;, LENGTH(hkey), &#39;\r\n&#39;,</span><br><span class="line">  hkey, &#39;\r\n&#39;,</span><br><span class="line">  &#39;$&#39;, LENGTH(hval), &#39;\r\n&#39;,</span><br><span class="line">  hval, &#39;\r&#39;</span><br><span class="line">)</span><br><span class="line">FROM (</span><br><span class="line">  SELECT</span><br><span class="line">  &#39;HSET&#39; as redis_cmd,</span><br><span class="line">  CONCAT(&#39;pid:&#39; ,pid) AS redis_key,</span><br><span class="line">  id AS hkey,</span><br><span class="line">  areaname AS hval</span><br><span class="line">  FROM t_area</span><br><span class="line">) AS t;</span><br></pre></td></tr></table></figure>

<h3 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p -h mysql服务器所在ip 数据库名 --skip-column-names --raw &lt; redis.sql</span><br></pre></td></tr></table></figure>

<h3 id="正式执行"><a href="#正式执行" class="headerlink" title="正式执行"></a>正式执行</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p -h mysql服务器所在ip 数据库名 --skip-column-names --raw &lt; redis.sql |&#x2F;usr&#x2F;local&#x2F;redis-3.2.12&#x2F;bin&#x2F;redis-cli -p 6379 --pipe</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">渐学顿悟</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


















  






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      const visitors = document.querySelector('.leancloud_visitors');
      const url = decodeURI(visitors.id);
      const title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            const counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      const visitors = document.querySelectorAll('.leancloud_visitors');
      const entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            const target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    const { app_id, app_key, server_url } = {"enable":true,"app_id":"wrre3Nrx21CqKiChLnKn034M-gzGzoHsz","app_key":"rkWWNONo7LAJhlS936vnywQ9","server_url":null,"security":true};
    function fetchData(api_server) {
      const Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    const api_server = app_id.slice(-9) === '-MdYXbMMI' ? `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com` : server_url;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


  

  

<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"wrre3Nrx21CqKiChLnKn034M-gzGzoHsz","appKey":"rkWWNONo7LAJhlS936vnywQ9","serverURLs":null,"placeholder":"请输入您的评论","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":false,"enableQQ":false,"requiredFields":["nick","mail"]}, {
      el: '#valine-comments',
      path: "/page/9/",
      serverURLs: "https://wrre3nrx.api.lncld.net"
    }));
  }, window.Valine);
});
</script>

</body>
</html>
